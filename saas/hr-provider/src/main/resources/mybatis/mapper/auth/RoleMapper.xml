<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nova.paas.auth.service.mapper.RoleMapper">
    <resultMap id="role" type="com.nova.paas.auth.service.entity.Role">
        <id property="id" column="id"/>
        <result property="tenantId" column="tenant_id"/>
        <result property="appId" column="app_id"/>
        <result property="roleCode" column="role_code"/>
        <result property="roleName" column="role_name"/>
        <result property="roleType" column="role_type"/>
        <result property="description" column="description"/>
        <result property="creator" column="creator"/>
        <result property="createTime" column="create_time"/>
        <result property="delFlag" column="del_flag"/>
        <result property="modifier" column="modifier"/>
        <result property="modifyTime" column="modify_time"/>
    </resultMap>

    <resultMap id="int" type="java.lang.Integer"/>

    <select id="queryRole" resultMap="role">
        select * from auth_role WHERE tenant_id=#{tenantId} and app_id=#{appId}
        <if test=" roleCode!= null and roleCode!=''">
            AND role_code=#{roleCode}
        </if>
        <if test="roleName != null and roleName!=''">
            AND role_name=#{roleName}
        </if>
        <if test="roleType != null ">
            AND role_type=#{roleType}
        </if>
        and del_flag=0
    </select>


    <select id="queryRoleByPage" resultMap="role">
        select * from auth_role WHERE tenant_id=#{tenantId} and app_id=#{appId}
        <if test=" roleCodes!= null and roleCodes.size()>0">
            AND role_code IN
            <foreach item="roles" collection="roleCodes" open="(" separator="," close=")">
                #{roles}
            </foreach>
        </if>
        <if test="roleName != null and roleName!=''">
            AND role_name=#{roleName}
        </if>
        <if test="roleType != null ">
            AND role_type=#{roleType}
        </if>
        and del_flag=0
        <if test="start!=null and page!=null and page.pageSize!=null">
            limit #{start},#{page.pageSize}
        </if>
    </select>

    <select id="queryRole2Count" resultMap="int">
        select count(id) from auth_role WHERE tenant_id=#{tenantId} and app_id=#{appId}
        <if test=" roleCodes!= null and roleCodes.size()>0">
            AND role_code IN
            <foreach item="roles" collection="roleCodes" open="(" separator="," close=")">
                #{roles}
            </foreach>
        </if>
        <if test="roleName != null and roleName!=''">
            AND role_name=#{roleName}
        </if>
        <if test="roleType != null ">
            AND role_type=#{roleType}
        </if>
        and del_flag=0
    </select>


    <select id="roleNameOrRoleCodeExists" resultType="String">
        select role_code from auth_role WHERE tenant_id=#{tenantId} and app_id=#{appId}
        <if test="roleCodes != null and roleCodes.size()>0">
            AND ( role_code IN
            <foreach item="roles" collection="roleCodes" open="(" separator="," close=")">
                #{roles}
            </foreach>
        </if>
        <if test="roleNames != null and roleNames.size()>0">
            <choose>
                <when test="roleCodes != null and roleCodes.size()>0">
                    or
                </when>
                <otherwise>
                    and
                </otherwise>
            </choose>
            role_name IN
            <foreach item="names" collection="roleNames" open="(" separator="," close=")">
                #{names}
            </foreach>
        </if>
        <if test="roleCodes != null and roleCodes.size()>0">
            )
        </if>
        and del_flag=0
    </select>


    <update id="batchDel">
        update auth_role set del_flag=1,modifier=#{modifier},modify_time=#{modifyTime} WHERE tenant_id=#{tenantId} and app_id=#{appId} and del_flag=0
        <if test="roleCodes != null and roleCodes.size()>0">
            AND role_code IN
            <foreach item="roles" collection="roleCodes" open="(" separator="," close=")">
                #{roles}
            </foreach>
        </if>
        <if test="roleName != null and roleName!=''">
            AND role_name=#{roleName}
        </if>
        <if test="roleType != null ">
            AND role_type=#{roleType}
        </if>
    </update>


    <select id="queryMatchRole" resultMap="role">
        select * from auth_role WHERE tenant_id=#{tenantId} and app_id=#{appId}
        <if test="roleCodes != null and roleCodes.size()>0">
            AND role_code IN
            <foreach item="roles" collection="roleCodes" open="(" separator="," close=")">
                #{roles}
            </foreach>
        </if>
        <if test="key != null and key!=''">
            AND role_name like CONCAT('%',#{key},'%')
        </if>
        <if test="roleType != null ">
            AND role_type=#{roleType}
        </if>
        and del_flag=0
        <if test="start!=null and page!=null and page.pageSize!=null">
            limit #{start},#{page.pageSize}
        </if>
    </select>

    <select id="queryMatchRoleCount" resultMap="int">
        select count(id) from auth_role WHERE tenant_id=#{tenantId} and app_id=#{appId}
        <if test="roleCodes != null and roleCodes.size()>0">
            AND role_code IN
            <foreach item="roles" collection="roleCodes" open="(" separator="," close=")">
                #{roles}
            </foreach>
        </if>
        <if test="key != null and key!=''">
            AND role_name like CONCAT('%',#{key},'%')
        </if>
        <if test="roleType != null ">
            AND role_type=#{roleType}
        </if>
        and del_flag=0
    </select>


</mapper>
