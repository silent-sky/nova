<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nova.paas.auth.mapper.FuncAccessMapper">
    <resultMap id="funcAccess" type="com.nova.paas.auth.entity.FuncAccess">
        <id property="id" column="id"/>
        <result property="tenantId" column="tenant_id"/>
        <result property="appId" column="app_id"/>
        <result property="roleCode" column="role_code"/>
        <result property="funcCode" column="func_code"/>
        <result property="delFlag" column="del_flag"/>
        <result property="modifier" column="modifier"/>
        <result property="modifyTime" column="modify_time"/>
    </resultMap>


    <select id="queryFuncAccessProvider" resultMap="funcAccess">
        select role_code,func_code from auth_func_access WHERE tenant_id=#{tenantId} and app_id=#{appId} and del_flag=0
        <if test="roles != null and roles.size()>0">
            AND role_code IN
            <foreach item="roleCodes" collection="roles" open="(" separator="," close=")">
                #{roleCodes}
            </foreach>
        </if>
        <if test="codes != null and codes.size()>0">
            AND func_code IN
            <foreach item="funcCodes" collection="codes" open="(" separator="," close=")">
                #{funcCodes}
            </foreach>
        </if>
    </select>


    <select id="queryFuncAccessEntitys" resultMap="funcAccess">
        select * from auth_func_access WHERE tenant_id=#{tenantId} and app_id=#{appId} and del_flag=0
        <if test="roles != null and roles.size()>0">
            AND role_code IN
            <foreach item="roleCodes" collection="roles" open="(" separator="," close=")">
                #{roleCodes}
            </foreach>
        </if>
        <if test="codes != null and codes.size()>0">
            AND func_code IN
            <foreach item="funcCodes" collection="codes" open="(" separator="," close=")">
                #{funcCodes}
            </foreach>
        </if>
    </select>


    <update id="batchDel">
        update func_access set del_flag=1,modifier=#{userId},modify_time=#{modifyTime} WHERE tenant_id=#{tenantId} and app_id=#{appId} and del_flag=0
        <if test="roleCode != null and roleCode!='' ">
            AND role_code=#{roleCode}
        </if>
        <if test="funcCodeList != null and funcCodeList.size()>0">
            AND func_code IN
            <foreach item="funcCodes" collection="funcCodeList" open="(" separator="," close=")">
                #{funcCodes}
            </foreach>
        </if>
    </update>

    <update id="batchDelFuncAccess">
        update func_access set del_flag=1,modifier=#{userId},modify_time=#{modifyTime} WHERE tenant_id=#{tenantId} and app_id=#{appId} and del_flag=0
        <if test="roleCodes != null and roleCodes.size()>0">
            AND role_code IN
            <foreach item="role" collection="roleCodes" open="(" separator="," close=")">
                #{role}
            </foreach>
        </if>
        <if test="funcCodes != null and funcCodes.size()>0">
            AND func_code IN
            <foreach item="func" collection="funcCodes" open="(" separator="," close=")">
                #{func}
            </foreach>
        </if>
    </update>

</mapper>
